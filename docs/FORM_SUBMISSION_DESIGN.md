# フォーム送信フロー設計

## やりたいこと

- フォーム送信後、**店舗スタッフがすぐにユーザーへ架電できる**ようにする
- そのために「届いた」ことを複数の経路で確実に知らせる

## 想定していた流れ（現実的か）

| 経路 | 内容 | 現実的か | 役割 |
|------|------|----------|------|
| **Gmail** (anella.kawasaki@gmail.com) | フォーム内容がメールで届く | ✅ 可能 | 記録・バックアップ・PCで確認 |
| **スプレッドシート** | フォーム内容が1行ずつ追記される | ✅ 可能 | 一覧管理・架電メモ・後から検索 |
| **Chatwork** | フォーム内容がルームに流れる | ✅ 可能 | **即時通知**（スマホプッシュで気づきやすい） |

**結論: 3つとも実現可能で、組み合わせる意味があります。**

- **即架電**には **Chatwork** が最も有効（スマホに即プッシュ）
- **Gmail** は届いた証拠・検索用
- **スプレッドシート** は架電結果メモや一覧管理に向いている

---

## 実装パターン（2案）

### 案A: このLP（Next.js）で完結（推奨）

- フォーム → **Next.js の API** に送信
- API 内で以下を実行:
  1. **メール送信** … Resend などで `anella.kawasaki@gmail.com` に送信
  2. **Chatwork** … Chatwork API で指定ルームにメッセージ投稿
  3. **スプレッドシート** … Google Sheets API で1行追加（任意）

**メリット**

- LP と送信先が一つのプロジェクトで管理できる
- フォームの見た目・項目を自由に変更できる
- デプロイ先（Vercel 等）の環境変数だけで設定できる

**必要な準備**

- Resend の API キー（または他のメール送信サービス）
- Chatwork の API トークン ＋ 通知用ルームID
- スプレッドシートを使う場合: Google のサービスアカウント ＋ 対象スプレッドシートの共有

---

### 案B: Google Apps Script を中継にする

- フォーム → **Google Apps Script の Web アプリ**（1本の URL）に POST
- スクリプト内で:
  1. **Gmail** … `MailApp.sendEmail()` で anella.kawasaki@gmail.com に送信
  2. **スプレッドシート** … 同じ GAS に紐づくスプレッドシートに `appendRow()`
  3. **Chatwork** … `UrlFetchApp.fetch()` で Chatwork API を呼ぶ

**メリット**

- Gmail・スプレッドシートは「同じ Google アカウント」で完結（追加の認証が少ない）
- 無料で運用しやすい

**デメリット**

- Apps Script の URL を公開する必要がある
- フォームの変更と、GAS の修正を両方メンテする必要がある

---

## このリポジトリでの採用方針

- **案A（Next.js API）** で実装する
- まず **メール（Resend）＋ Chatwork** まで実装し、届いたら即架電できるようにする
- **スプレッドシート** はオプションとして用意し、必要なときに Google Sheets API を有効化できるようにする

---

## フォーム送信後のユーザー体験

1. ユーザーが「無料見学・体験に申し込む」をクリック
2. 送信中はボタンを無効化し「送信中…」表示（二重送信防止）
3. 成功時: 「お申し込みありがとうございます。担当スタッフより折り返しご連絡いたします。」を表示
4. 失敗時: 「送信に失敗しました。お手数ですが電話でご連絡ください。」等を表示（トーストまたはメッセージ）

---

## 架電を早くするための運用のコツ

- **Chatwork** の通知をオンにし、スマホで即確認する
- ルームには「架電済み」「折り返し待ち」など簡単なルールを決めておく
- スプレッドシートを使う場合は「架電結果」列を用意し、架電後に記入すると一覧で追いやすい

---

## スプレッドシートへの記録

**実装済み**です。Google Sheets API（サービスアカウント）で、フォーム送信のたびに「日時・お名前・電話番号・メール・ご希望・ご質問」を1行で追記します。

設定は **任意** です。`GOOGLE_SHEET_ID` と `GOOGLE_SERVICE_ACCOUNT_JSON` を設定すると追記が有効になり、未設定の場合はメールと Chatwork のみ動作します。

**設定手順**は [docs/GOOGLE_SHEETS_SETUP.md](GOOGLE_SHEETS_SETUP.md) にまとめています（Google Cloud でサービスアカウント作成 → スプレッドシートを共有 → 環境変数に JSON を設定）。
